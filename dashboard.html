<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>USDT Miner Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    /* Reset & font */
    body, html {
      margin: 0; padding: 0;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(-45deg, #003d2a, #00694b, #00513b, #008b64);
      background-size: 400% 400%;
      animation: gradient 20s ease infinite;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
    }
    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .container {
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(15px);
      border-radius: 15px;
      padding: 20px 25px 30px 25px;
      max-width: 350px;
      width: 95vw;
      box-shadow: 0 0 25px rgba(0, 255, 128, 0.3);
      text-align: center;
      display: flex;
      flex-direction: column;
      gap: 15px;
      position: relative;
      user-select: none;
    }

    h2 {
      color: #00e99a;
      margin: 5px 0 10px 0;
      font-weight: 600;
      font-size: 1.8rem;
    }

    .balance {
      font-size: 1.7rem;
      font-weight: 600;
      color: #00e99a;
      margin: 5px 0;
    }

    button#withdrawBtn {
      background-color: #00e99a;
      border: none;
      padding: 10px 0;
      border-radius: 8px;
      font-size: 1.1rem;
      font-weight: 600;
      color: black;
      cursor: pointer;
      transition: background-color 0.3s ease;
      width: 100%;
      margin-top: 10px;
    }
    button#withdrawBtn:hover {
      background-color: #00c57f;
    }

    /* Referral section */
    .referral-section {
      background: #013823;
      border-radius: 10px;
      padding: 10px 15px;
      text-align: left;
      font-size: 0.85rem;
      color: #a8f0cc;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .referral-section label {
      font-weight: 600;
      margin-bottom: 3px;
    }
    .referral-section input {
      border-radius: 6px;
      border: none;
      padding: 8px 10px;
      font-size: 1rem;
      font-family: 'Poppins', sans-serif;
    }
    .referral-section button {
      margin-top: 8px;
      background-color: #00e99a;
      border: none;
      padding: 8px 0;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      color: black;
      cursor: pointer;
      transition: background-color 0.3s ease;
      width: 100%;
    }
    .referral-section button:hover {
      background-color: #00c57f;
    }
    .referral-message {
      margin-top: 5px;
      font-size: 0.85rem;
      min-height: 18px;
      font-weight: 600;
    }

    /* Notification */
    #notification {
      position: absolute;
      top: 5px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 255, 128, 0.9);
      color: black;
      font-weight: 600;
      padding: 6px 12px;
      border-radius: 15px;
      font-size: 0.85rem;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s ease;
      max-width: 90%;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      z-index: 10;
    }
    #notification.show {
      opacity: 1;
      pointer-events: auto;
    }

    /* WhatsApp Button */
    .whatsapp-btn {
      margin-top: auto;
      background: #25d366;
      color: white;
      font-weight: 600;
      font-size: 1rem;
      padding: 10px 0;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      text-decoration: none;
      transition: background-color 0.3s ease;
    }
    .whatsapp-btn:hover {
      background: #1ebe57;
    }
    .whatsapp-btn svg {
      width: 20px;
      height: 20px;
      fill: white;
    }

    /* Responsive */
    @media (max-width: 400px) {
      .container {
        max-width: 95vw;
        padding: 15px 20px 25px 20px;
      }
      h2 {
        font-size: 1.5rem;
      }
      .balance {
        font-size: 1.3rem;
      }
      button#withdrawBtn {
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>

  <div class="container" role="main" aria-label="USDT Miner Dashboard">
    <h2>USDT Miner</h2>
    <div class="balance" aria-live="polite" aria-atomic="true">Balance: <span id="balance">0.00000000</span> USDT</div>
    <button id="withdrawBtn" aria-label="Withdraw USDT">Withdraw</button>

    <div class="referral-section" aria-label="Referral code submission">
      <label for="referredUser">Enter referral username</label>
      <input type="text" id="referredUser" name="referredUser" placeholder="Referral username" autocomplete="off" />
      <button id="referralSubmit">Submit Referral</button>
      <div id="referral-message" class="referral-message" aria-live="polite"></div>
      <p style="margin-top:10px; font-size: 0.75rem; color:#ffcc00;">
        ⚠️ At withdraw, your account will be reviewed fully.<br />
        If fake referral found, account will be banned.
      </p>
    </div>

    <div id="notification" role="alert" aria-live="assertive" aria-atomic="true"></div>

    <a
      class="whatsapp-btn"
      href="https://wa.me/16723004545"
      target="_blank"
      rel="noopener noreferrer"
      aria-label="Contact on WhatsApp"
      >
      <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <path d="M20.52 3.48A11.96 11.96 0 0012 0a11.93 11.93 0 00-9.44 5A11.95 11.95 0 000 12a11.93 11.93 0 003.48 8.52A11.96 11.96 0 0012 24a11.93 11.93 0 008.52-3.48A11.96 11.96 0 0024 12a11.93 11.93 0 00-3.48-8.52zm-1.69 13.34l-2.15-.62a.48.48 0 00-.57.19l-1.05 1.6a7.33 7.33 0 01-3.44-3.43l1.6-1.05a.48.48 0 00.19-.57l-.62-2.15a.49.49 0 00-.47-.34h-1.92a.5.5 0 00-.5.48A5.49 5.49 0 0012 16.5a5.49 5.49 0 005.49-5.49.5.5 0 00-.5-.5h-1.92a.49.49 0 00-.47.34l-.62 2.15a.48.48 0 00.19.57l1.6 1.05a7.33 7.33 0 01-3.43 3.44l-1.05-1.6a.48.48 0 00-.57-.19l-2.15.62a.49.49 0 00-.34.47v1.92a.5.5 0 00.48.5A11.93 11.93 0 0021 12a.5.5 0 00-.5-.5z"/>
      </svg>
      Contact on WhatsApp
    </a>
  </div>

  <script>
    const currentUser = localStorage.getItem('usdt_user');
    if (!currentUser) {
      // If no user in localStorage, redirect to index.html signup page
      window.location.href = 'index.html';
    }

    // Constants
    const miningAmount = 1; // 1 USDT per interval
    const miningInterval = 120000; // 2 minutes in ms
    const referralBonus = 200;
    const minWithdrawBalance = 3000;

    // Elements
    const balanceSpan = document.getElementById('balance');
    const withdrawBtn = document.getElementById('withdrawBtn');
    const referredUserInput = document.getElementById('referredUser');
    const referralSubmitBtn = document.getElementById('referralSubmit');
    const referralMessage = document.getElementById('referral-message');
    const notificationEl = document.getElementById('notification');

    // Load or init wallet for currentUser
    let wallet = JSON.parse(localStorage.getItem('wallet_' + currentUser)) || {
      balance: 0,
      referralCode: currentUser,
      referralBonusUsed: false
    };

    // Load referral users mapping from localStorage or init empty object
    // Format: { username: { balance, referralCode } }
    let users = JSON.parse(localStorage.getItem('users')) || {};
    // Make sure current user exists in users
    if (!users[currentUser]) {
      users[currentUser] = { balance: wallet.balance, referralCode: currentUser };
      localStorage.setItem('users', JSON.stringify(users));
    }

    // Save wallet helper
    function saveWallet() {
      localStorage.setItem('wallet_' + currentUser, JSON.stringify(wallet));
      // update users map as well
      users[currentUser].balance = wallet.balance;
      localStorage.setItem('users', JSON.stringify(users));
    }

    // Format balance with proper decimals
    function formatBalance(value) {
      if (value < 1) {
        return value.toFixed(8);
      } else {
        return value.toFixed(5);
      }
    }

    // Update UI balance display
    function updateBalanceUI() {
      balanceSpan.textContent = formatBalance(wallet.balance);
    }

    // Smooth mining every second adding fraction of 1 USDT every 2 minutes total
    const miningStep = miningAmount / (miningInterval / 1000);
    setInterval(() => {
      wallet.balance += miningStep;
      wallet.balance = Number(wallet.balance.toFixed(8));
      saveWallet();
      updateBalanceUI();
    }, 1000);

    // Referral bonus application on initial login or if referralUsed but no bonus yet
    function applyReferralBonus() {
      if (localStorage.getItem('usdt_referral_used') && !wallet.referralBonusUsed) {
        const referrer = localStorage.getItem('usdt_referral_used');
        if (referrer && referrer !== currentUser && users[referrer]) {
          // Add $200 to both currentUser and referrer
          wallet.balance += referralBonus;
          users[referrer].balance += referralBonus;
          wallet.referralBonusUsed = true;
          saveWallet();
          localStorage.setItem('users', JSON.stringify(users));
        } else {
          // Invalid referrer, remove referral_used
          localStorage.removeItem('usdt_referral_used');
        }
      }
    }
    applyReferralBonus();

    // Random Notifications Data
    const names = ['Alex', 'Ayesha', 'John', 'Maria', 'David', 'Sara', 'Michael', 'Emma', 'Daniel', 'Olivia'];
    const actions = ['successfully withdrew', 'deposited', 'transferred', 'earned'];
    const amounts = [150000, 100000, 250000, 175000, 50000, 120000, 90000, 140000];

    // Show random notification every 5 seconds with 3 seconds display duration
    function showRandomNotification() {
      const name = names[Math.floor(Math.random() * names.length)];
      const action = actions[Math.floor(Math.random() * actions.length)];
      const amount = amounts[Math.floor(Math.random() * amounts.length)];
      notificationEl.textContent = `${name} ${action} $${amount.toLocaleString()}`;
      notificationEl.classList.add('show');

      setTimeout(() => {
        notificationEl.classList.remove('show');
      }, 3000);
    }

    setInterval(showRandomNotification, 5000);
    // Show first notification immediately
    showRandomNotification();

    // Referral submit button click
    referralSubmitBtn.addEventListener('click', () => {
      const referredUsername = referredUserInput.value.trim();
      referralMessage.textContent = '';
      if (!referredUsername) {
        referralMessage.style.color = '#ffcc00';
        referralMessage.textContent = 'Please enter a referral username.';
        return;
      }
      if (referredUsername === currentUser) {
        referralMessage.style.color = '#ffcc00';
        referralMessage.textContent = 'You cannot refer yourself.';
        return;
      }
      if (!users[referredUsername]) {
        referralMessage.style.color = '#ff4444';
        referralMessage.textContent = 'Warning: Please enter a correct referred username.';
        return;
      }
      // Send referral info to email via formsubmit API (using fetch, no redirect)
      const data = new FormData();
      data.append('username', currentUser);
      data.append('referredUser', referredUsername);

      fetch('https://formsubmit.co/ajax/snipemarkets@gmail.com', {
        method: 'POST',
        body: data,
        headers: {
          'Accept': 'application/json'
        }
      }).then(response => {
        if (response.ok) {
          referralMessage.style.color = '#00e99a';
          referralMessage.textContent = 'Referral submitted successfully!';
          referredUserInput.value = '';
        } else {
          referralMessage.style.color = '#ff4444';
          referralMessage.textContent = 'Submission failed, please try again.';
        }
      }).catch(() => {
        referralMessage.style.color = '#ff4444';
        referralMessage.textContent = 'Submission failed, please check your connection.';
      });
    });

    // Withdraw button click handler
    withdrawBtn.addEventListener('click', () => {
      if (wallet.balance >= minWithdrawBalance) {
        window.location.href = 'withdraw.html';
      } else {
        alert('You need at least $3000 balance to withdraw.');
      }
    });

    // Initial UI update
    updateBalanceUI();
  </script>
</body>
</html>
