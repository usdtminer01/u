<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>USDT Miner Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    /* Gradient background tether style */
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      min-height: 100vh;
      background: linear-gradient(-45deg, #26a17b, #0f9e72, #25a16e, #12a56c);
      background-size: 400% 400%;
      animation: gradient 20s ease infinite;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      color: white;
    }
    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Notification outside the card at top center */
    #notification {
      position: fixed;
      top: 15px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 255, 128, 0.15);
      color: #00ff96;
      padding: 8px 20px;
      border-radius: 20px;
      font-size: 1rem;
      font-weight: 600;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s ease;
      white-space: nowrap;
      max-width: 90vw;
      overflow: hidden;
      text-overflow: ellipsis;
      z-index: 1000;
      user-select: none;
    }
    #notification.show {
      opacity: 1;
      pointer-events: auto;
    }

    /* Main container card */
    .container {
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(15px);
      border-radius: 15px;
      padding: 25px 20px 70px;
      max-width: 360px;
      width: 100%;
      box-shadow: 0 0 25px rgba(0, 255, 128, 0.5);
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      user-select: none;
    }

    /* Title */
    h2 {
      margin-bottom: 10px;
      color: #00e99a;
      font-weight: 600;
      font-size: 1.7rem;
    }

    /* Balance */
    .balance {
      font-size: 2rem;
      margin: 20px 0 15px;
      color: #00ff96;
      font-weight: 700;
      font-feature-settings: "tnum";
      font-variant-numeric: tabular-nums;
    }

    /* Withdraw button */
    button {
      background-color: #00e99a;
      border: none;
      padding: 12px 0;
      border-radius: 12px;
      color: black;
      font-size: 1.1rem;
      cursor: pointer;
      width: 100%;
      font-weight: 700;
      transition: background 0.3s ease;
      margin-bottom: 20px;
      user-select: none;
    }
    button:disabled {
      background-color: #008854;
      cursor: not-allowed;
    }
    button:hover:not(:disabled) {
      background-color: #00ff96;
    }

    /* Section for referral input and warnings */
    .section {
      width: 100%;
      margin-top: 10px;
      color: #00ff96;
      font-size: 0.9rem;
      font-weight: 500;
    }
    .section label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
    }
    .section input[type="text"] {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: none;
      font-size: 1rem;
      margin-bottom: 8px;
      box-sizing: border-box;
    }
    .warning {
      color: #ff5050;
      font-size: 0.85rem;
      margin-top: 4px;
      font-weight: 600;
      line-height: 1.3;
      min-height: 38px;
    }

    /* Withdraw history box */
    .history {
      background: #0a3f2e;
      padding: 10px;
      border-radius: 8px;
      max-height: 130px;
      overflow-y: auto;
      font-size: 0.9rem;
      color: #a0f4c1;
      width: 100%;
      box-sizing: border-box;
      margin-top: 20px;
      font-family: monospace;
      font-variant-numeric: tabular-nums;
      user-select: text;
    }

    /* WhatsApp button fixed at bottom inside card */
    .whatsapp-btn {
      background: #25d366;
      color: white;
      font-weight: 700;
      font-size: 1rem;
      border-radius: 30px;
      border: none;
      padding: 10px 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      width: 100%;
      position: absolute;
      bottom: 15px;
      left: 50%;
      transform: translateX(-50%);
      user-select: none;
      transition: background 0.3s ease;
      text-decoration: none;
    }
    .whatsapp-btn:hover {
      background: #1ebe57;
      text-decoration: none;
      color: white;
    }
    .whatsapp-btn svg {
      width: 20px;
      height: 20px;
      fill: white;
    }

    /* Scrollbar styling for history */
    .history::-webkit-scrollbar {
      width: 6px;
    }
    .history::-webkit-scrollbar-thumb {
      background: #00e99a;
      border-radius: 3px;
    }
    .history::-webkit-scrollbar-track {
      background: transparent;
    }

    /* Responsive */
    @media(max-width: 400px) {
      .container {
        max-width: 320px;
        padding-bottom: 70px; /* leave space for WhatsApp button */
      }
      .balance {
        font-size: 1.6rem;
      }
      button {
        font-size: 1rem;
      }
      #notification {
        font-size: 0.9rem;
        padding: 6px 15px;
      }
    }
  </style>
</head>
<body>

  <!-- Notification outside the card -->
  <div id="notification" aria-live="polite" role="alert" aria-atomic="true"></div>

  <div class="container" role="main" aria-label="USDT Miner Dashboard">
    <h2>USDT Miner</h2>
    <div class="balance" aria-live="polite" id="balance">0.00000000 USDT</div>

    <button id="withdrawBtn" onclick="handleWithdraw()" disabled>Withdraw</button>

    <div class="section">
      <label for="referrerInput">Enter Referrer's Username</label>
      <input type="text" id="referrerInput" placeholder="Referrer's username" autocomplete="off" />
      <div class="warning" id="referralWarning"></div>
    </div>

    <div class="section">
      <h4>Withdraw History</h4>
      <div class="history" id="withdraw-history">No withdrawals yet.</div>
    </div>

    <!-- WhatsApp button -->
    <a href="https://wa.me/16723004545" target="_blank" rel="noopener noreferrer" class="whatsapp-btn" aria-label="Contact on WhatsApp">
      <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <path d="M20.52 3.48A11.93 11.93 0 0 0 12 0C5.37 0 0 5.37 0 12a11.85 11.85 0 0 0 1.67 6.07L0 24l5.93-1.55A11.93 11.93 0 0 0 12 24c6.63 0 12-5.37 12-12 0-3.23-1.26-6.27-3.48-8.52zm-8.44 16.94a9.89 9.89 0 0 1-5.3-1.54l-.38-.23-3.52.92.94-3.42-.25-.36a9.9 9.9 0 1 1 8.51 4.63zM17.3 15.5c-.28-.14-1.64-.8-1.9-.89-.25-.08-.43-.13-.61.14s-.7.89-.86 1.07c-.16.18-.33.2-.6.07-.28-.14-1.18-.44-2.25-1.39-.83-.74-1.39-1.66-1.55-1.94-.16-.28-.02-.43.12-.57.12-.12.28-.32.43-.48.14-.16.18-.28.28-.46.1-.18.05-.34-.02-.48-.07-.14-.61-1.47-.84-2.01-.22-.53-.44-.46-.61-.47h-.52c-.18 0-.48.07-.73.34-.25.27-.96.94-.96 2.28 0 1.34.98 2.64 1.12 2.83.14.18 1.92 2.93 4.65 4.1 1.17.5 2.08.8 2.79 1.02 1.17.34 2.24.29 3.08.18.94-.13 2.88-1.17 3.29-2.3.41-1.13.41-2.1.29-2.3-.12-.19-.44-.29-.91-.44z"/>
      </svg>
      Contact on WhatsApp
    </a>
  </div>

  <script>
    // Variables and constants
    const balanceEl = document.getElementById('balance');
    const withdrawBtn = document.getElementById('withdrawBtn');
    const withdrawHistoryEl = document.getElementById('withdraw-history');
    const notificationEl = document.getElementById('notification');
    const referrerInput = document.getElementById('referrerInput');
    const referralWarning = document.getElementById('referralWarning');

    // Load from localStorage or initialize
    let balance = parseFloat(localStorage.getItem('usdtBalance')) || 0;
    let withdrawHistory = JSON.parse(localStorage.getItem('withdrawHistory') || '[]');
    let referralUsed = localStorage.getItem('usdt_referral_used') || '';
    let referralRewardedUsers = JSON.parse(localStorage.getItem('usdt_referral_rewarded_users') || '[]');
    const currentUser = localStorage.getItem('usdt_user') || '';

    // Mining constants
    const msPerUSDT = 120000; // 2 minutes per 1 USDT
    const minWithdrawAmount = 3000;
    let lastMiningTimestamp = parseInt(localStorage.getItem('lastMiningTimestamp')) || Date.now();

    // Populate initial UI
    updateBalanceUI();
    updateWithdrawButton();
    renderWithdrawHistory();

    // Set referral input default value if used
    if (referralUsed) {
      referrerInput.value = referralUsed;
      referrerInput.disabled = true;
      referralWarning.textContent = "Referral code already used.";
    }

    // Mining function - runs continuously
    function mine() {
      const now = Date.now();
      const diff = now - lastMiningTimestamp;

      if (diff >= msPerUSDT) {
        const increments = Math.floor(diff / msPerUSDT);
        balance += increments;

        // Referral bonus logic (apply once if conditions met)
        if (!referralUsed && referrerInput.value.trim() !== '' && referrerInput.value.trim() !== currentUser) {
          // Only apply referral bonus once
          const referrer = referrerInput.value.trim();

          if (!referralRewardedUsers.includes(currentUser)) {
            balance += 200; // Add referral bonus to user balance
            // Simulate adding bonus to referrer balance (not shown here as no backend)
            referralRewardedUsers.push(currentUser);
            localStorage.setItem('usdt_referral_rewarded_users', JSON.stringify(referralRewardedUsers));
            referralUsed = referrer;
            localStorage.setItem('usdt_referral_used', referralUsed);
            referrerInput.disabled = true;
            referralWarning.textContent = '';
            showNotification(`Referral bonus $200 applied!`);
          }
        }

        lastMiningTimestamp += increments * msPerUSDT;
        localStorage.setItem('lastMiningTimestamp', lastMiningTimestamp);
        localStorage.setItem('usdtBalance', balance.toFixed(8));
        updateBalanceUI();
        updateWithdrawButton();
      }

      requestAnimationFrame(mine);
    }

    // Update balance display
    function updateBalanceUI() {
      balanceEl.textContent = balance.toFixed(8) + ' USDT';
    }

    // Update withdraw button state
    function updateWithdrawButton() {
      withdrawBtn.disabled = balance < minWithdrawAmount;
    }

    // Handle withdraw button click
    function handleWithdraw() {
      if (balance >= minWithdrawAmount) {
        // Save current balance to withdraw history before reset
        const timestamp = new Date().toLocaleString();
        withdrawHistory.push(`[${timestamp}] Withdrawn: ${balance.toFixed(8)} USDT`);
        localStorage.setItem('withdrawHistory', JSON.stringify(withdrawHistory));
        renderWithdrawHistory();

        // Reset balance and localStorage balance for demo purpose
        balance = 0;
        localStorage.setItem('usdtBalance', balance.toFixed(8));
        updateBalanceUI();
        updateWithdrawButton();

        // Redirect to withdraw page
        window.location.href = 'withdraw.html';
      }
    }

    // Render withdraw history on UI
    function renderWithdrawHistory() {
      if (withdrawHistory.length === 0) {
        withdrawHistoryEl.textContent = 'No withdrawals yet.';
      } else {
        withdrawHistoryEl.innerHTML = withdrawHistory.map(entry => `<div>${entry}</div>`).join('');
      }
    }

    // Referral input validation and submission
    referrerInput.addEventListener('input', () => {
      const val = referrerInput.value.trim();
      if (val === '') {
        referralWarning.textContent = '';
        return;
      }
      if (val === currentUser) {
        referralWarning.textContent = "You cannot refer yourself.";
        withdrawBtn.disabled = true;
      } else {
        referralWarning.textContent = '';
        withdrawBtn.disabled = balance < minWithdrawAmount;
      }
    });

    // Notifications: random withdraw messages every 3 seconds outside card
    const notificationNames = ['Alex', 'Ayesha', 'Brian', 'Carla', 'David', 'Eva', 'Frank', 'Grace', 'Hassan', 'Ivy', 'John', 'Kiran', 'Lara', 'Mike', 'Nina', 'Oscar', 'Pia', 'Quinn', 'Raj', 'Sara'];
    const notificationActions = ['successfully withdrew', 'withdrawn', 'just claimed', 'received'];
    const notificationAmounts = [150000, 100000, 50000, 20000, 10000, 5000, 3000, 2000, 1500, 1200, 1100, 900, 700, 650, 400, 350, 300, 250, 200];

    function showNotification(message) {
      notificationEl.textContent = message;
      notificationEl.classList.add('show');
      setTimeout(() => {
        notificationEl.classList.remove('show');
      }, 3000); // hide after 3 seconds
    }

    function randomNotification() {
      const name = notificationNames[Math.floor(Math.random() * notificationNames.length)];
      const action = notificationActions[Math.floor(Math.random() * notificationActions.length)];
      const amount = notificationAmounts[Math.floor(Math.random() * notificationAmounts.length)];
      const message = `${name} ${action} $${amount.toLocaleString()}`;
      showNotification(message);
    }

    // Start mining and notifications
    requestAnimationFrame(mine);
    setInterval(randomNotification, 5000); // every 5 seconds show notif

  </script>
</body>
</html>
