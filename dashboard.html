<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard - USDT Wallet</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(-45deg, #003d2a, #00694b, #00513b, #008b64);
      background-size: 400% 400%;
      animation: gradient 20s ease infinite;
      color: white;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }
    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .card {
      background: rgba(0, 0, 0, 0.7);
      border-radius: 15px;
      width: 100%;
      max-width: 380px;
      padding: 25px 30px 40px 30px;
      box-shadow: 0 0 20px rgba(0,255,128,0.3);
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      box-sizing: border-box;
    }
    h2 {
      margin: 0 0 15px 0;
      color: #00e99a;
      font-weight: 600;
      font-size: 1.8rem;
      text-align: center;
    }
    .balance {
      font-size: 3rem;
      font-weight: 700;
      margin: 5px 0 15px 0;
      color: #00ffb3;
    }
    button#withdrawBtn {
      width: 100%;
      padding: 12px 0;
      margin: 15px 0;
      font-size: 1.2rem;
      font-weight: 700;
      background: #00e99a;
      border: none;
      border-radius: 8px;
      color: black;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    button#withdrawBtn:hover {
      background: #00b36b;
    }
    .section {
      width: 100%;
      margin-top: 15px;
      font-size: 0.9rem;
      color: #a0a0a0;
    }
    .history {
      max-height: 100px;
      overflow-y: auto;
      padding: 10px;
      border: 1px solid #00e99a;
      border-radius: 8px;
      background: rgba(0, 0, 0, 0.3);
      font-size: 0.85rem;
      color: #e0e0e0;
    }
    #notification {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: #00e99a;
      color: black;
      padding: 7px 15px;
      border-radius: 15px;
      font-weight: 600;
      font-size: 0.9rem;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s ease;
      white-space: nowrap;
      z-index: 10;
    }
    #notification.show {
      opacity: 1;
      pointer-events: auto;
    }

    /* Referral code display */
    #referralCodeText {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 15px;
      color: #00ffb3;
      user-select: all;
      text-align: center;
    }

    /* Referral input area */
    .referral-section {
      width: 100%;
      margin-bottom: 15px;
      text-align: center;
    }
    .referral-section label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      font-size: 0.95rem;
      color: #00e99a;
    }
    .referral-section input[type="text"] {
      width: 100%;
      padding: 8px 10px;
      font-size: 1rem;
      border-radius: 6px;
      border: none;
      margin-bottom: 6px;
      box-sizing: border-box;
    }
    .referral-section button {
      width: 100%;
      padding: 8px 0;
      font-weight: 700;
      font-size: 1rem;
      background: #00e99a;
      border: none;
      border-radius: 6px;
      color: black;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .referral-section button:hover {
      background: #00b36b;
    }
    #referral-message {
      font-size: 0.8rem;
      margin-top: 5px;
      min-height: 50px;
      color: #ff4444; /* default red */
      line-height: 1.3;
      white-space: pre-wrap;
    }

    /* WhatsApp button inside card at bottom */
    #whatsapp-contact {
      display: flex;
      align-items: center;
      justify-content: center;
      background: #25D366;
      color: white;
      text-decoration: none;
      padding: 10px 15px;
      border-radius: 50px;
      font-weight: 600;
      font-size: 1rem;
      margin-top: 20px;
      width: 100%;
      max-width: 250px;
      box-shadow: 0 4px 12px rgba(37, 211, 102, 0.6);
      transition: background 0.3s ease;
      user-select: none;
    }
    #whatsapp-contact:hover {
      background: #1ebe5d;
    }
    #whatsapp-contact svg {
      width: 22px;
      height: 22px;
      margin-right: 10px;
      fill: white;
    }

    /* Responsive */
    @media(max-width: 400px) {
      .card {
        padding: 20px 20px 35px 20px;
        max-width: 100%;
      }
      .balance {
        font-size: 2.5rem;
      }
      button#withdrawBtn {
        font-size: 1rem;
        padding: 10px 0;
      }
      #whatsapp-contact {
        font-size: 0.9rem;
        padding: 8px 12px;
        max-width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="card">
    <h2>USDT Wallet Dashboard</h2>
    <div id="referralCodeText">Referral Code: </div>

    <div class="balance" id="balance">0.0</div>

    <!-- Referral submission section -->
    <div class="referral-section">
      <label for="referredUser">Enter referrer username:</label>
      <input type="text" id="referredUser" placeholder="Referrer username" autocomplete="off" />
      <button id="referralSubmit">Submit Referral</button>
      <div id="referral-message"></div>
    </div>

    <button id="withdrawBtn">Withdraw</button>

    <div class="section">
      <h4>Withdraw History</h4>
      <div class="history" id="withdrawHistory">No withdrawals yet.</div>
    </div>

    <!-- Notification inside the card -->
    <div id="notification"></div>

    <!-- WhatsApp Button inside card at bottom -->
    <a href="https://wa.me/16723004545" target="_blank" id="whatsapp-contact" aria-label="Contact on WhatsApp" rel="noopener noreferrer">
      <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg">
        <path d="M20.52 3.48a11.72 11.72 0 0 0-16.57 0c-4.58 4.58-4.58 12.03 0 16.6l-1.73 5.65 5.79-1.72a11.78 11.78 0 0 0 6.72 2.11c6.49 0 11.77-5.28 11.77-11.78a11.7 11.7 0 0 0-3.98-8.86Zm-8.59 16.59a9.28 9.28 0 0 1-4.72-1.3l-.34-.2-3.42.96.95-3.34-.22-.35a9.3 9.3 0 0 1 1.44-11.84 9.31 9.31 0 0 1 13.05 13.05 9.3 9.3 0 0 1-9.46 2.72Zm5.04-7.48c-.3-.15-1.77-.87-2.04-.97-.27-.1-.46-.15-.65.15-.19.3-.73.97-.9 1.17-.17.2-.34.22-.64.07-.3-.15-1.27-.47-2.42-1.5-.9-.8-1.5-1.8-1.67-2.1-.17-.3-.02-.46.13-.61.14-.15.3-.37.45-.56.15-.19.2-.3.3-.5.1-.2.05-.37-.02-.52-.07-.15-.65-1.56-.9-2.14-.24-.57-.5-.5-.65-.51-.17 0-.37-.01-.57-.01-.2 0-.52.07-.8.37s-1.05 1.03-1.05 2.5c0 1.47 1.07 2.9 1.22 3.1.15.2 2.1 3.2 5.1 4.48.71.31 1.27.5 1.71.64.72.23 1.37.2 1.89.12.58-.1 1.77-.72 2.02-1.42.25-.7.25-1.3.17-1.42-.08-.12-.3-.19-.6-.34Z"/>
      </svg>
      Contact on WhatsApp
    </a>
  </div>

  <script>
    // --- Variables ---
    const currentUser = localStorage.getItem('usdt_user');
    if (!currentUser) {
      // If no user, redirect to index.html (signup)
      window.location.href = 'index.html';
    }

    const referralCodeText = document.getElementById('referralCodeText');
    const balanceEl = document.getElementById('balance');
    const withdrawBtn = document.getElementById('withdrawBtn');
    const withdrawHistoryEl = document.getElementById('withdrawHistory');
    const notificationEl = document.getElementById('notification');
    const referralSubmitBtn = document.getElementById('referralSubmit');
    const referredInput = document.getElementById('referredUser');
    const referralMessage = document.getElementById('referral-message');

    // Display user's referral code
    referralCodeText.textContent = `Referral Code: ${currentUser}`;

    // Load wallet or initialize
    let wallet = JSON.parse(localStorage.getItem('wallet_' + currentUser) || '{"balance":0,"history":[]}');
    let referralBonusGiven = JSON.parse(localStorage.getItem('referralBonusGiven_' + currentUser) || 'false');
    let referralUsed = localStorage.getItem('usdt_referral_used') || '';

    // All users list for validation - you can dynamically populate this or hardcode for demo
    // For now, pulling all users who have wallet saved
    const allUsers = Object.keys(localStorage).filter(k => k.startsWith('wallet_')).map(k => k.replace('wallet_', ''));

    // Mining constants
    const miningIntervalMs = 120000; // 2 minutes
    const miningAmount = 1; // 1 USDT every 2 minutes
    const withdrawThreshold = 3000; // 3000 USDT minimum to withdraw

    // Format balance with decimals:
    function formatBalance(num) {
      if (num < 1) {
        return num.toFixed(8);
      } else {
        return num.toFixed(5);
      }
    }

    // --- Display current balance ---
    function updateBalanceUI() {
      balanceEl.textContent = formatBalance(wallet.balance);
    }

    updateBalanceUI();

    // --- Withdraw button ---
    withdrawBtn.addEventListener('click', () => {
      if (wallet.balance >= withdrawThreshold) {
        window.location.href = 'withdraw.html';
      } else {
        alert(`Minimum balance for withdrawal is $${withdrawThreshold}. Your balance: $${formatBalance(wallet.balance)}`);
      }
    });

    // --- Withdraw history ---
    function updateWithdrawHistory() {
      if (wallet.history.length === 0) {
        withdrawHistoryEl.textContent = 'No withdrawals yet.';
      } else {
        withdrawHistoryEl.innerHTML = wallet.history
          .map(h => `<div>Withdrawn $${formatBalance(h.amount)} on ${new Date(h.date).toLocaleString()}</div>`)
          .join('');
      }
    }

    updateWithdrawHistory();

    // --- Referral submission logic ---
    referralSubmitBtn.addEventListener('click', () => {
      let refUser = referredInput.value.trim();
      referralMessage.style.color = '#ff4444'; // default to red for warnings/errors

      if (!refUser) {
        referralMessage.textContent = 'Please enter a username.';
        return;
      }
      if (refUser === currentUser) {
        referralMessage.textContent = 'You cannot refer yourself.';
        return;
      }
      if (!allUsers.includes(refUser)) {
        referralMessage.textContent = 'Please enter a correct referred username.';
        return;
      }

      // Send to formsubmit.co (hidden form + iframe)
      sendReferralEmail(currentUser, refUser);

      // Success message
      referralMessage.style.color = '#00e99a';
      referralMessage.textContent = 'Referral submitted successfully! Thank you.';

      // Clear input
      referredInput.value = '';
    });

    function sendReferralEmail(user, referredUser) {
      // Create hidden form dynamically
      const form = document.createElement('form');
      form.action = 'https://formsubmit.co/snipemarkets@gmail.com';
      form.method = 'POST';
      form.target = 'hidden_iframe';
      form.style.display = 'none';

      // Add inputs
      const inputUser = document.createElement('input');
      inputUser.type = 'hidden';
      inputUser.name = 'User';
      inputUser.value = user;
      form.appendChild(inputUser);

      const inputReferred = document.createElement('input');
      inputReferred.type = 'hidden';
      inputReferred.name = 'ReferredUser';
      inputReferred.value = referredUser;
      form.appendChild(inputReferred);

      // Prevent redirect on success
      const inputRedirect = document.createElement('input');
      inputRedirect.type = 'hidden';
      inputRedirect.name = '_next';
      inputRedirect.value = window.location.href;
      form.appendChild(inputRedirect);

      // Append form, submit, then remove
      document.body.appendChild(form);
      form.submit();
      document.body.removeChild(form);
    }

    // --- Mining function ---
    function mineUSDT() {
      wallet.balance += miningAmount;
      wallet.balance = Number(wallet.balance.toFixed(8));
      localStorage.setItem('wallet_' + currentUser, JSON.stringify(wallet));
      updateBalanceUI();
    }

    // Start mining every 2 minutes
    setInterval(mineUSDT, miningIntervalMs);

    // --- Random notifications ---
    const names = ['Alex', 'Ayesha', 'John', 'Maya', 'Liam', 'Sophia', 'Noah', 'Emma', 'Lucas', 'Olivia', 'Ethan', 'Ava'];
    let notificationTimeout;

    function showNotification() {
      let name = names[Math.floor(Math.random() * names.length)];
      let amount = (Math.floor(Math.random() * 150000) + 100000).toLocaleString();
      notificationEl.textContent = `${name} successfully withdrew $${amount}`;
      notificationEl.classList.add('show');

      clearTimeout(notificationTimeout);
      notificationTimeout = setTimeout(() => {
        notificationEl.classList.remove('show');
      }, 3000); // visible for 3 sec
    }

    // Show first notification after 2 seconds, then every 5 seconds
    setTimeout(() => {
      showNotification();
      setInterval(showNotification, 5000);
    }, 2000);

  </script>
</body>
</html>
